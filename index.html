<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JP CDJR Pay Calculator</title>
  <style>
    :root { --border:#e6e6e6; --muted:#6b6b6b; }
    * { box-sizing: border-box; }
    body { font-family: -apple-system, system-ui, Arial, sans-serif; margin: 18px; }
    h1 { font-size: 18px; margin: 0; }
    .sub { font-size: 12px; color: var(--muted); margin-top: 4px; line-height: 1.25; }
    .card { border: 1px solid var(--border); border-radius: 16px; padding: 14px; margin: 12px 0; background: #fff; }
    .row { display: flex; align-items: center; justify-content: space-between; gap: 12px; flex-wrap: wrap; }
    .label { font-size: 12px; color: var(--muted); }
    .big { font-size: 30px; font-weight: 800; line-height: 1; }
    .mid { font-size: 18px; font-weight: 700; }
    .btn { padding: 10px 16px; border-radius: 14px; border: 1px solid #d0d0d0; background: #f7f7f7; font-size: 20px; }
    .btn:active { transform: scale(0.98); }
    .pill { border: 1px solid var(--border); padding: 6px 10px; border-radius: 999px; font-size: 12px; color: #111; background: #fafafa; }
    input[type="number"] { width: 100%; padding: 12px; border-radius: 14px; border: 1px solid #d0d0d0; font-size: 18px; text-align: center; }
    input[readonly] { background: #f2f2f2; }
    .divider { height: 1px; background: #f0f0f0; margin: 12px 0; }
    .result { border: 2px solid #111; }
    .goalCard { border: 1px solid var(--border); border-radius: 16px; padding: 12px; }
    .goalTitle { font-size: 12px; color: var(--muted); }
    .goalValue { font-size: 20px; font-weight: 900; margin-top: 4px; }
    .goalMeta { font-size: 12px; margin-top: 6px; color: #222; line-height: 1.25; }
    .tiny { font-size: 11px; color: var(--muted); line-height: 1.25; }
    .linkbtn { font-size: 12px; border: 1px solid var(--border); background:#fafafa; padding:6px 10px; border-radius: 12px; }
  </style>
</head>
<body>

<div class="row" style="align-items:flex-start;">
  <div>
    <h1>Jason Pilger CDJR Pay Calculator</h1>
    <div class="sub">
      ‚úÖ Remembers your <b>current month</b> car count automatically<br/>
      üîÅ Resets to <b>0</b> when the month changes<br/>
      Draw = $650/wk √ó 4 weeks (locked)
    </div>
  </div>
  <div class="pill" id="monthPill">Month: ‚Äî</div>
</div>

<!-- Units -->
<div class="card">
  <div class="row">
    <div>
      <div class="label">Cars Sold (this month)</div>
      <div class="big" id="unitsDisplay">0</div>
      <div class="tiny" id="savedHint">Saved automatically.</div>
    </div>
    <div class="row">
      <button class="btn" onclick="changeUnits(-1)">‚àí</button>
      <input id="unitsInput" type="number" value="0" readonly />
      <button class="btn" onclick="changeUnits(1)">+</button>
    </div>
  </div>

  <div class="divider"></div>

  <div class="row">
    <div>
      <div class="label">Tier (retro to 1)</div>
      <div class="mid" id="tierText">0‚Äì8</div>
    </div>
    <div>
      <div class="label">Pay / Car</div>
      <div class="big" id="rateText">$150</div>
    </div>
  </div>

  <div class="divider"></div>

  <div class="row">
    <button class="linkbtn" onclick="resetNow()">Reset to 0</button>
    <span class="tiny">Use only if you entered the wrong number.</span>
  </div>
</div>

<!-- Bonus -->
<div class="card">
  <label style="display:flex; gap:10px; align-items:center;">
    <input id="som" type="checkbox" />
    <span>Salesperson of the Month (+$750)</span>
  </label>
</div>

<!-- Result -->
<div class="card result">
  <div class="label">Pay Status (pre-tax)</div>
  <div class="big" id="check">$0</div>
  <div class="divider"></div>
  <div class="row">
    <div>
      <div class="label">Base Commission</div>
      <div class="mid" id="base">$0</div>
    </div>
    <div>
      <div class="label">Bonuses</div>
      <div class="mid" id="bonus">$0</div>
    </div>
    <div>
      <div class="label">Monthly Draw</div>
      <div class="mid" id="draw">$2,600</div>
    </div>
  </div>
</div>

<div class="divider"></div>
<div class="row">
  <div>
    <div class="label">Grand Total (this month)</div>
    <div class="mid" id="grandTotal">$0</div>
  </div>
  <div>
    <div class="label">Cars to clear draw</div>
    <div class="mid" id="carsToClear">0</div>
  </div>
</div>

<!-- Goal Mode -->
<div class="card">
  <div class="label"><b>Goal Mode</b></div>
  <div class="sub">One box ‚Ä¢ Saved automatically</div>

  <div style="margin-top:10px;">
    <input id="goalInput" type="number" step="any" placeholder="Type your goal (ex: 16)" />
  </div>

  <div id="goalCardWrap" style="margin-top:10px;"></div>
</div>

<script>
  // Locked assumptions per your request
  const WEEKLY_DRAW = 650;
  const WEEKS = 4;
  const MONTHLY_DRAW = WEEKLY_DRAW * WEEKS;

  // Storage keys
  const LS_UNITS = "jp_cdjr_units_current";
  const LS_MONTH = "jp_cdjr_units_month";      // "YYYY-MM"
  const LS_GOAL  = "jp_cdjr_goal_units";

  const fmt = n => "$" + Math.round(n).toLocaleString("en-US");
  const monthKey = () => {
    const d = new Date();
    const y = d.getFullYear();
    const m = String(d.getMonth()+1).padStart(2,"0");
    return `${y}-${m}`;
  };

function breakevenUnits(){
  for (let u = 0; u <= 60; u++){
    if (calc(u).check >= 0) return u;
  }
  return 60;
}

  function monthLabel(k){
    // k: YYYY-MM
    const [y,m] = k.split("-").map(x=>parseInt(x,10));
    const names = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
    return `${names[(m||1)-1]} ${y}`;
  }

  function tierInfo(u){
    if (u <= 8)  return { tier: "0‚Äì8",  rate: 150 };
    if (u <= 12) return { tier: "9‚Äì12", rate: 225 };
    if (u <= 15) return { tier: "13‚Äì15", rate: 275 };
    if (u <= 18) return { tier: "16‚Äì18", rate: 325 };
    if (u <= 21) return { tier: "19‚Äì21", rate: 425 };
    return { tier: "22+", rate: 450 };
  }

  function volumeBonus(u){
    if (u >= 21) return 3600;
    if (u >= 17) return 2800;
    if (u >= 12) return 2000;
    return 0;
  }

  function calc(u){
    const t = tierInfo(u);
    const base = u * t.rate;
    const bonus = volumeBonus(u) + (document.getElementById("som").checked ? 750 : 0);
    const check = base + bonus - MONTHLY_DRAW;
    return { t, base, bonus, check };
  }

  function setText(id, v){ document.getElementById(id).textContent = v; }

  function saveUnits(u){
    try {
      localStorage.setItem(LS_UNITS, String(u));
      localStorage.setItem(LS_MONTH, monthKey());
    } catch(e) {}
  }

  function loadUnitsWithMonthlyReset(){
    const nowM = monthKey();
    let storedM = null, storedU = null;
    try {
      storedM = localStorage.getItem(LS_MONTH);
      storedU = localStorage.getItem(LS_UNITS);
    } catch(e) {}

    // If month changed (or never set), reset to 0
    if (!storedM || storedM !== nowM){
      saveUnits(0);
      return 0;
    }
    const u = Number(storedU || 0);
    return Number.isFinite(u) ? Math.max(0, Math.floor(u)) : 0;
  }

  function renderMain(){
    const u = Number(document.getElementById("unitsInput").value || 0);
    const r = calc(u);
    setText("grandTotal", fmt(r.base + r.bonus));

const be = breakevenUnits();
setText("carsToClear", u >= be ? "Draw cleared ‚úÖ" : String(be - u));
    setText("unitsDisplay", u);
    setText("tierText", r.t.tier);
    setText("rateText", fmt(r.t.rate));
    if (r.check < 0) {
  setText("check", "Draw balance remaining: " + fmt(Math.abs(r.check)));
} else {
  setText("check", "Commission check: " + fmt(r.check));
}
    setText("base", fmt(r.base));
    setText("bonus", fmt(r.bonus));
    setText("draw", fmt(MONTHLY_DRAW));
  }

  function renderGoal(){
    const wrap = document.getElementById("goalCardWrap");
    wrap.innerHTML = "";
    const raw = document.getElementById("goalInput").value;
    if (raw === "" || raw === null) return;

    const u = Number(raw);
    if (!Number.isFinite(u)) return;

    const r = calc(u);
    const div = document.createElement("div");
    div.className = "goalCard";
    div.innerHTML =
      '<div class="goalTitle">Your Goal</div>' +
      '<div class="goalValue">' + u + ' units</div>' +
      '<div class="goalMeta">Tier: ' + r.t.tier + ' @ ' + fmt(r.t.rate) + '/unit</div>' +
      '<div class="goalMeta">Check: <b>' + fmt(r.check) + '</b></div>';
    wrap.appendChild(div);
  }

  function render(){ renderMain(); renderGoal(); }

  // Buttons
  window.changeUnits = function(delta){
    const input = document.getElementById("unitsInput");
    const next = Math.max(0, Number(input.value || 0) + delta);
    input.value = next;
    saveUnits(next);
    renderMain();
  }

  window.resetNow = function(){
    const input = document.getElementById("unitsInput");
    input.value = 0;
    saveUnits(0);
    renderMain();
  }

  // Goal save/load
  const goalEl = document.getElementById("goalInput");
  goalEl.addEventListener("input", () => {
    try { localStorage.setItem(LS_GOAL, goalEl.value); } catch(e) {}
    renderGoal();
  });

  function loadGoal(){
    try {
      const saved = localStorage.getItem(LS_GOAL);
      if (saved !== null && saved !== "") goalEl.value = saved;
    } catch(e) {}
  }

  // Initialize
  (function init(){
    const m = monthKey();
    document.getElementById("monthPill").textContent = "Month: " + monthLabel(m);

    // Load units (auto reset on month change)
    const u = loadUnitsWithMonthlyReset();
    document.getElementById("unitsInput").value = u;

    // Load goal
    loadGoal();

    document.getElementById("som").addEventListener("change", renderMain);

    render();
  })();
</script>

</body>
</html>
